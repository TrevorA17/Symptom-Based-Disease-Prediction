---
title: "Symptom-Based Disease Prediction"
author: "Trevor Okinda"
date: "2025"
output:
  github_document: 
    toc: yes
    toc_depth: 4
    fig_width: 6
    fig_height: 4
    df_print: default
editor_options:
  chunk_output_type: console
---

# Student Details

|                                              |     |
|----------------------------------------------|-----|
| **Student ID Number**                        | 134780 |
| **Student Name**                             | Trevor Okinda |
| **BBIT 4.2 Group**                           | C |
| **Project Name**                             | A Symptom-Based disease prediction model |

# Setup Chunk

**Note:** the following KnitR options have been set as the global defaults: <BR> `knitr::opts_chunk$set(echo = TRUE, warning = FALSE, eval = TRUE, collapse = FALSE, tidy = TRUE)`.

More KnitR options are documented here <https://bookdown.org/yihui/rmarkdown-cookbook/chunk-options.html> and here <https://yihui.org/knitr/options/>.

```{r setup, include=FALSE}
library(formatR)
knitr::opts_chunk$set(
  warning = FALSE,
  collapse = FALSE
)
```

# Understanding the Dataset (Exploratory Data Analysis (EDA))

## Loading the Dataset

### Source: 

The dataset that was used can be downloaded here: *\<https://www.kaggle.com/datasets/miltonmacgyver/symptom-based-disease-prediction-dataset\>*

### Reference:

*\*MiltonMacGyver. (n.d.). Symptom-Based Disease Prediction Dataset [Data set]. Kaggle. https://www.kaggle.com/datasets/miltonmacgyver/symptom-based-disease-prediction-dataset*
\>\

Refer to the APA 7th edition manual for rules on how to cite datasets: <https://apastyle.apa.org/style-grammar-guidelines/references/examples/data-set-references>*

# Exploratory Data Analysis
## Load dataset
```{r load dataset}
# Load libraries
library(tidyverse)

# Choose and load dataset with correct column types
file_path <- file.choose()

SymptomData <- read.csv(file_path, colClasses = c(
  fever = "factor",
  cough = "factor",
  headache = "factor",
  nausea = "factor",
  vomiting = "factor",
  fatigue = "factor",
  sore_throat = "factor",
  chills = "factor",
  body_pain = "factor",
  loss_of_appetite = "factor",
  abdominal_pain = "factor",
  diarrhea = "factor",
  sweating = "factor",
  rapid_breathing = "factor",
  dizziness = "factor",
  label = "factor" # Target variable
))

# Quick check
str(SymptomData)
summary(SymptomData)

# Frequency of each disease label
table(SymptomData$label)
```
## Measures of Frequency
```{r MOF}
# Frequency of each disease label
table(SymptomData$label)

# Frequency of each symptom being present (1) or absent (0)
symptom_freq <- sapply(SymptomData[ , -ncol(SymptomData)], function(col) table(col))
symptom_freq
```

## Measures of Distribution
```{r MOD}
# Convert factors to numeric (0/1) for calculation
symptom_numeric <- SymptomData %>%
  mutate(across(-label, ~ as.numeric(as.character(.))))

# Mean presence of each symptom
colMeans(symptom_numeric[ , -ncol(symptom_numeric)])

# Distribution for each symptom
summary(symptom_numeric[ , -ncol(symptom_numeric)])
```

## Measures of Relationship
```{r MOR}
# Visual distribution for one example symptom
library(ggplot2)
ggplot(SymptomData, aes(x = fever)) +
  geom_bar(fill = "steelblue") +
  labs(title = "Distribution of Fever Symptom")

# Chi-square test for fever vs disease
chisq.test(table(SymptomData$fever, SymptomData$label))

# Cram√©r's V for all symptoms vs label
library(DescTools)
cramers_v <- sapply(SymptomData[ , -ncol(SymptomData)], function(symptom) {
  CramerV(table(symptom, SymptomData$label))
})
cramers_v
```

## Plots
```{r Plots}
library(ggplot2)

ggplot(SymptomData, aes(x = label)) +
  geom_bar(fill = "steelblue") +
  labs(title = "Disease Distribution", x = "Disease", y = "Count") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
# Convert to numeric for counting
symptom_numeric <- SymptomData %>%
  mutate(across(-label, ~ as.numeric(as.character(.))))

symptom_counts <- colSums(symptom_numeric[ , -ncol(symptom_numeric)] == 1)

symptom_df <- data.frame(
  Symptom = names(symptom_counts),
  Count = as.numeric(symptom_counts)
)

ggplot(symptom_df, aes(x = reorder(Symptom, -Count), y = Count)) +
  geom_bar(stat = "identity", fill = "darkorange") +
  coord_flip() +
  labs(title = "Symptom Frequency", x = "Symptom", y = "Count")

# Example: Fever vs Disease
ggplot(SymptomData, aes(x = label, fill = fever)) +
  geom_bar(position = "fill") +
  labs(title = "Proportion of Fever Presence by Disease",
       y = "Proportion") +
  scale_fill_manual(values = c("0" = "lightgray", "1" = "red"))
# Choose a few symptoms to display
selected_symptoms <- c("fever", "cough", "headache")

SymptomData %>%
  pivot_longer(cols = all_of(selected_symptoms), names_to = "Symptom", values_to = "Value") %>%
  ggplot(aes(x = label, fill = Value)) +
  geom_bar(position = "fill") +
  facet_wrap(~ Symptom) +
  labs(title = "Symptom Presence by Disease", y = "Proportion") +
  scale_fill_manual(values = c("0" = "lightgray", "1" = "darkgreen"))

library(tidyverse)

label_col <- "label"

# Convert symptom columns to numeric (keep label as factor)
symptom_numeric <- SymptomData %>%
  mutate(across(setdiff(names(SymptomData), label_col), ~ as.numeric(as.character(.))))

# Group by label and calculate mean (proportion of '1's)
symptom_summary <- symptom_numeric %>%
  group_by(.data[[label_col]]) %>%
  summarise(across(setdiff(names(symptom_numeric), label_col), mean), .groups = "drop") %>%
  pivot_longer(-.data[[label_col]], names_to = "Symptom", values_to = "Proportion")

# Heatmap
ggplot(symptom_summary, aes(x = Symptom, y = .data[[label_col]], fill = Proportion)) +
  geom_tile(color = "white") +
  scale_fill_gradient(low = "white", high = "blue") +
  labs(title = "Symptom Presence by Disease",
       x = "Symptom",
       y = "Disease",
       fill = "Proportion") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```
# Preprocessing and Data Transformation
## Missing Values
```{r Missing Values}
# Count missing values per column
colSums(is.na(SymptomData))

# Total missing values in dataset
sum(is.na(SymptomData))
```

# Training Model
## Data Splitting
```{r Data Splitting}
library(caret)

set.seed(123)  # For reproducibility

# 80/20 split
train_index <- createDataPartition(SymptomData$label, p = 0.8, list = FALSE)
train_data <- SymptomData[train_index, ]
test_data  <- SymptomData[-train_index, ]

dim(train_index)
dim(train_data)
```
## Bootstrapping
```{r Bootstrapping}
ctrl_boot <- trainControl(method = "boot", number = 50)  # 50 bootstrap resamples
print(ctrl_boot)

ctrl_cv <- trainControl(method = "cv", number = 10)
print(ctrl_cv)
```
## Model Training
```{r Model Training}
# Logistic Regression
# Naive Bayes
model_nb <- train( label ~ .,  data = train_data, method = "naive_bayes", trControl = ctrl_cv )

# Decision Tree
model_tree <- train( label ~ .,  data = train_data, method = "rpart", trControl = ctrl_cv )

# Random Forest
model_rf <- train( label ~ .,  data = train_data, method = "rf", trControl = ctrl_cv )
```
## Model Resamples
```{r resamples}
results <- resamples(list(
  NaiveBayes = model_nb,
  DecisionTree = model_tree,
  RandomForest = model_rf
))

summary(results)
bwplot(results)
dotplot(results)
```
## Saving Model
```{r Saving Model}
# Load the saved Naive Bayes model (when needed)
loaded_nb_model <- readRDS(file.path(repo_path, "models", "saved_nb_model.rds"))

# Helper function to align new data to training data structure
prepare_new_data <- function(new_data, training_data) {
  # Remove label from training data
  train_features <- training_data[, setdiff(names(training_data), "label")]
  
  # Ensure all expected columns are present in new_data
  for (col in names(train_features)) {
    if (!col %in% names(new_data)) {
      new_data[[col]] <- NA  # fill missing columns with NA
    }
  }
  
  # Reorder columns to match training data
  new_data <- new_data[, names(train_features)]
  
  # Convert column types to match training
  for (col in names(train_features)) {
    if (is.factor(train_features[[col]])) {
      new_data[[col]] <- factor(new_data[[col]], levels = levels(train_features[[col]]))
    } else {
      new_data[[col]] <- as.numeric(new_data[[col]])
    }
  }
  
  return(new_data)
}

# Example usage
new_data_input <- data.frame(
  fever = 1,
  cough = 0,
  headache = 1,
  nausea = 0,
  vomiting = 0,
  fatigue = 1,
  sore_throat = 0,
  chills = 1,
  body_pain = 1,
  loss_of_appetite = 0,
  abdominal_pain = 0,
  diarrhea = 0,
  sweating = 1,
  rapid_breathing = 0,
  dizziness = 0
)

# Prepare data
new_data_ready <- prepare_new_data(new_data_input, train_data)

# Predict
predictions <- predict(loaded_nb_model, newdata = new_data_ready)
print(predictions)
```
















